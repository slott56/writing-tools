<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>language &#8212; Fiction Tools 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <script src="../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for language</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">ConLang Grammar and Lexicon.</span>

<span class="sd">See https://www.nltk.org/book/ch05.html for the Parts-of-Speech Tags</span>

<span class="sd">Also, see https://www.ling.upenn.edu/courses/Fall_2003/ling001/penn_treebank_pos.html</span>
<span class="sd">for a more complete set.</span>

<span class="sd">See https://www.cis.upenn.edu/~bies/manuals/tagguide.pdf</span>

<span class="sd">Also https://universaldependencies.org/u/pos/all.html</span>

<span class="sd">The tricky part is -- of course -- the grammar.</span>

<span class="sd">Our goal is to move from a tagged English parse tree to the ConLang tree through a number of transformations.</span>

<span class="sd">Input</span>
<span class="sd">::</span>

<span class="sd">    (S (VP (TV kill) (NP (DET the) (N mage))))</span>

<span class="sd">In English, this Transitive Verb example doesn&#39;t have a subject only an object.</span>
<span class="sd">English permits ``S -&gt; VP NP`` as well as more the more conventional ``S -&gt; NP VP`` structures.</span>

<span class="sd">See https://ucrel.lancs.ac.uk/bnc2/bnc2guide.htm where VVI/VVZ is used for imperative.</span>

<span class="sd">The target ConLang in this implementation is ``VP NP NP``, ``VP NP PP``, ``VP NP PP NP PP`` kinds of things. Note the recursive</span>
<span class="sd">NP -&gt; Det Nominal and Nominal -&gt; Nominal Noun to permit constructing complicated relationships.</span>

<span class="sd">&quot;go-Kill you the mage&quot; sorts of constructs.</span>
<span class="sd">Present is the base form.</span>
<span class="sd">Imperative is a &quot;go-&quot; prefix.</span>
<span class="sd">Present participle (&quot;-ing&quot; in English) is a &quot;now-&quot; prefix.</span>
<span class="sd">Past (&quot;-ed&quot; in English) is a &quot;did-&quot; prefix.</span>
<span class="sd">No person conjugation. It&#39;s a separate word after the verb.</span>

<span class="sd">..  csv-table:: Verb Subcategories</span>

<span class="sd">    Symbol,	Meaning,	Example</span>
<span class="sd">    IV,	intransitive verb,	barked ``(VP -&gt; IV Adj)``</span>
<span class="sd">    TV,	transitive verb,	saw a man ``(VP -&gt; TV NP)``</span>
<span class="sd">    DatV,	dative verb,	gave a dog to a man ``(VP -&gt; NP PP)``</span>
<span class="sd">    SV,	sentential verb,	said that a dog barked ``(V -&gt; SV S)``</span>

<span class="sd">Generally, this example ConLang lacks Intransitive verbs. &quot;did-Bark the dog at something.&quot;</span>
<span class="sd">&quot;did-See myself the man.&quot; &quot;did-Give the dog to a man.&quot; &quot;did-Say the man did-Bark the dog at something.&quot;</span>

<span class="sd">Rules needed</span>
<span class="sd">============</span>

<span class="sd">- Pivot Declarative to VP first. ``(S (NP $n) (VP $v) $x) -&gt; (S (VP $v) (NP $n) $x)``.</span>
<span class="sd">  Imperative ``(S (VP))`` left alone.</span>
<span class="sd">  Interrogative ``(S (Aux NP VP))``, ``(S (Wh-NP VP))``, ``(S (Wh-NP Aux NP VP))`` should also be swapped around to verb first.</span>

<span class="sd">- Adverbs are split out with a helper. ``(VP $x (ADVP (NP $y))) -&gt; (VP $x (PP with (NP $y)))``.</span>

<span class="sd">- The Verb Subcategories rules, above.</span>

<span class="sd">- Apply Tense Prefix to base Verb&#39;s stem word. ``(VP (MD $m) (VP $v)) -&gt; (VP ${f|prefix(m)}))`` rewrite verb root with mode prefix.</span>

<span class="sd">- Apply noun determiner suffix to nounds ``(NP (DET $d) (N $n)) -&gt; (NP ${n|suffix(d)})``.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">argparse</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">bisect</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">deque</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">csv</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">io</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">itertools</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pprint</span><span class="w"> </span><span class="kn">import</span> <span class="n">pprint</span><span class="p">,</span> <span class="n">pformat</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">textwrap</span><span class="w"> </span><span class="kn">import</span> <span class="n">dedent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">TypeVar</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Union</span>

<span class="c1">### Weighted Choices.</span>

<span class="n">CT</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s2">&quot;CT&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="weighted_choice">
<a class="viewcode-back" href="../language.html#language.weighted_choice">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">weighted_choice</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">CT</span><span class="p">,</span> <span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">CT</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Given [(string, int), ...] weighted strings, pick a string.&quot;&quot;&quot;</span>
    <span class="n">choices</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">source</span><span class="p">)</span>
    <span class="n">cumulative_dist</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">accumulate</span><span class="p">(</span><span class="n">weights</span><span class="p">))</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span><span class="o">*</span><span class="n">cumulative_dist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">choices</span><span class="p">[</span><span class="n">bisect</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="n">cumulative_dist</span><span class="p">,</span> <span class="n">selection</span><span class="p">)]</span></div>


<span class="k">def</span><span class="w"> </span><span class="nf">test_weighted_choice_1</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">source</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">weighted_choice</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
    <span class="k">assert</span> <span class="n">examples</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>
    <span class="n">distribution</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">distribution</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">263</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">257</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">242</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">238</span><span class="p">)]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_weighted_choice_2</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">source</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">)]</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">examples</span> <span class="o">=</span> <span class="p">[</span><span class="n">weighted_choice</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">)]</span>
    <span class="k">assert</span> <span class="n">examples</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">]</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>
    <span class="n">distribution</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">distribution</span><span class="o">.</span><span class="n">most_common</span><span class="p">()</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mi">551</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mi">271</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mi">126</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mi">52</span><span class="p">)]</span>


<span class="c1">### Lexicon.</span>

<span class="c1"># For this application, weighted choices are strings.</span>

<span class="n">WeightedChoices</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span>


<div class="viewcode-block" id="WordMaker">
<a class="viewcode-back" href="../language.html#language.WordMaker">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">WordMaker</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create words from a few rules.</span>

<span class="sd">    1. Markov chains based on digraphs.</span>
<span class="sd">    2. Initial Letter thrown on kind of randomly.</span>
<span class="sd">    3. Seeded RNG from source word.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># https://www.math.cornell.edu/~mec/2003-2004/cryptography/subs/digraphs.html</span>
    <span class="n">digraph_text</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">    Digraph	Count	 	Digraph	Frequency</span>
<span class="s1">    th	5532	 	th	1.52</span>
<span class="s1">    he	4657	 	he	1.28</span>
<span class="s1">    in	3429	 	in	0.94</span>
<span class="s1">    er	3420	 	er	0.94</span>
<span class="s1">    an	3005	 	an	0.82</span>
<span class="s1">    re	2465	 	re	0.68</span>
<span class="s1">    nd	2281	 	nd	0.63</span>
<span class="s1">    at	2155	 	at	0.59</span>
<span class="s1">    on	2086	 	on	0.57</span>
<span class="s1">    nt	2058	 	nt	0.56</span>
<span class="s1">    ha	2040	 	ha	0.56</span>
<span class="s1">    es	2033	 	es	0.56</span>
<span class="s1">    st	2009	 	st	0.55</span>
<span class="s1">    en	2005	 	en	0.55</span>
<span class="s1">    ed	1942	 	ed	0.53</span>
<span class="s1">    to	1904	 	to	0.52</span>
<span class="s1">    it	1822	 	it	0.50</span>
<span class="s1">    ou	1820	 	ou	0.50</span>
<span class="s1">    ea	1720	 	ea	0.47</span>
<span class="s1">    hi	1690	 	hi	0.46</span>
<span class="s1">    is	1660	 	is	0.46</span>
<span class="s1">    or	1556	 	or	0.43</span>
<span class="s1">    ti	1231	 	ti	0.34</span>
<span class="s1">    as	1211	 	as	0.33</span>
<span class="s1">    te	985	 	te	0.27</span>
<span class="s1">    et	704	 	et	0.19</span>
<span class="s1">    ng	668	 	ng	0.18</span>
<span class="s1">    of	569	 	of	0.16</span>
<span class="s1">    al	341	 	al	0.09</span>
<span class="s1">    de	332	 	de	0.09</span>
<span class="s1">    se	300	 	se	0.08</span>
<span class="s1">    le	298	 	le	0.08</span>
<span class="s1">    sa	215	 	sa	0.06</span>
<span class="s1">    si	186	 	si	0.05</span>
<span class="s1">    ar	157	 	ar	0.04</span>
<span class="s1">    ve	148	 	ve	0.04</span>
<span class="s1">    ra	137	 	ra	0.04</span>
<span class="s1">    ld	64	 	ld	0.02</span>
<span class="s1">    ur	60	 	ur	0.02</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># https://en.wikipedia.org/wiki/Letter_frequency</span>
    <span class="n">first_letter_text</span> <span class="o">=</span> <span class="n">dedent</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s1">    Letter	Frequency</span>
<span class="s1">    z	0.034%</span>
<span class="s1">    y	1.620%</span>
<span class="s1">    x	0.017%</span>
<span class="s1">    w	6.753%</span>
<span class="s1">    v	0.649%</span>
<span class="s1">    u	1.487%</span>
<span class="s1">    t	16.671%</span>
<span class="s1">    s	7.755%</span>
<span class="s1">    r	1.653%</span>
<span class="s1">    q	0.173%</span>
<span class="s1">    p	2.545%</span>
<span class="s1">    o	6.264%</span>
<span class="s1">    n	2.365%</span>
<span class="s1">    m	4.383%</span>
<span class="s1">    l	2.705%</span>
<span class="s1">    k	0.590%</span>
<span class="s1">    j	0.597%</span>
<span class="s1">    i	6.286%</span>
<span class="s1">    h	7.232%</span>
<span class="s1">    g	1.950%</span>
<span class="s1">    f	3.779%</span>
<span class="s1">    e	2.007%</span>
<span class="s1">    d	2.670%</span>
<span class="s1">    c	3.511%</span>
<span class="s1">    b	4.702%</span>
<span class="s1">    a	11.602%</span>
<span class="s1">    &#39;&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># Real data: http://norvig.com/mayzner.html</span>
    <span class="c1"># Handy approximation</span>
    <span class="c1"># word lengths are 2 to 12, linear 200 down to 20 occurrences.</span>
    <span class="c1"># (x, y) = (2, 200)</span>
    <span class="c1"># (x, y) = (12, 20)</span>
    <span class="c1"># m = Fraction(200-20)/Fraction(2-12) = -18</span>
    <span class="c1"># b = 200-m*2 = 236</span>
    <span class="n">lengths</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="mi">236</span><span class="o">-</span><span class="mi">18</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">13</span><span class="p">)]</span>

<div class="viewcode-block" id="WordMaker.__init__">
<a class="viewcode-back" href="../language.html#language.WordMaker.__init__">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">make_seed</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the generator using a seed-creating function</span>
<span class="sd">        and loading the frequency tables.</span>

<span class="sd">        :param make_seed: a function to transform English word to a seed for generating a ConLang word.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_digraph_markov</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_first_letters</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_seed</span> <span class="o">=</span> <span class="n">make_seed</span></div>


<div class="viewcode-block" id="WordMaker.load_digraph_markov">
<a class="viewcode-back" href="../language.html#language.WordMaker.load_digraph_markov">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_digraph_markov</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">source_file</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digraph_text</span><span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">source_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">digraphs</span><span class="p">:</span> <span class="n">WeightedChoices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Digraph&#39;</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Count&#39;</span><span class="p">]))</span>
            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span>
        <span class="p">)</span>

        <span class="c1"># The digraphs -- alone -- aren&#39;t very English like.</span>
        <span class="c1"># Turning them into Markov Chains is more useful.</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">markov</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">WeightedChoices</span><span class="p">]</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">digraph</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">digraphs</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">nextc</span> <span class="o">=</span> <span class="n">digraph</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">markov</span><span class="p">[</span><span class="n">start</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">nextc</span><span class="p">,</span> <span class="n">count</span><span class="p">))</span></div>


<div class="viewcode-block" id="WordMaker.load_first_letters">
<a class="viewcode-back" href="../language.html#language.WordMaker.load_first_letters">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">load_first_letters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">source_file</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_letter_text</span><span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">source_file</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">skipinitialspace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_letters</span> <span class="o">=</span> <span class="nb">list</span><span class="p">((</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Letter&#39;</span><span class="p">],</span> <span class="mi">1000</span><span class="o">*</span><span class="nb">float</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Frequency&#39;</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">)</span></div>


<div class="viewcode-block" id="WordMaker.word">
<a class="viewcode-back" href="../language.html#language.WordMaker.word">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seed</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Expand weighted Markov chains through the digraphs.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">seed</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">make_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">))</span>

        <span class="n">target_length</span> <span class="o">=</span> <span class="n">weighted_choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lengths</span><span class="p">)</span>
        <span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span> <span class="o">=</span> <span class="n">weighted_choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digraphs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target_length</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">c_0</span> <span class="o">=</span> <span class="n">weighted_choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_letters</span><span class="p">)</span>
            <span class="n">w</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_0</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">]</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">target_length</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">markov</span><span class="p">:</span>
                <span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weighted_choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">markov</span><span class="p">[</span><span class="n">w</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">target_length</span> <span class="o">+=</span> <span class="mi">2</span>
                <span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span> <span class="o">=</span> <span class="n">weighted_choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">digraphs</span><span class="p">)</span>
                <span class="n">w</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span> <span class="n">c_1</span><span class="p">,</span> <span class="n">c_2</span><span class="p">])</span>
        <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">w</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="naive_seed">
<a class="viewcode-back" href="../language.html#language.naive_seed">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">naive_seed</span><span class="p">(</span><span class="n">original</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform source word into RNG seed. Seems to have too many collisions.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">original</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span></div>



<div class="viewcode-block" id="hash_seed">
<a class="viewcode-back" href="../language.html#language.hash_seed">[docs]</a>
<span class="k">def</span><span class="w"> </span><span class="nf">hash_seed</span><span class="p">(</span><span class="n">original</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform source word into RNG seed.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="n">original</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;ascii&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">digest</span><span class="p">())</span></div>



<span class="k">def</span><span class="w"> </span><span class="nf">test_wordmaker</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">WordMaker</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span><span class="p">)</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">)]</span>
    <span class="k">assert</span> <span class="n">words</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="s1">&#39;aesth&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="s1">&#39;he&#39;</span><span class="p">,</span> <span class="s1">&#39;tere&#39;</span><span class="p">,</span> <span class="s1">&#39;tnt&#39;</span><span class="p">,</span> <span class="s1">&#39;cesth&#39;</span><span class="p">,</span> <span class="s1">&#39;yeng&#39;</span><span class="p">,</span> <span class="s1">&#39;jonde&#39;</span><span class="p">,</span> <span class="s1">&#39;in&#39;</span><span class="p">]</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
    <span class="n">lexicon</span> <span class="o">=</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">word</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">)]</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">Counter</span>
    <span class="n">first</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">lexicon</span><span class="p">)</span>
    <span class="n">pct</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(((</span><span class="n">letter</span><span class="p">,</span> <span class="mi">100</span><span class="o">*</span><span class="n">count</span><span class="o">/</span><span class="mi">5000</span><span class="p">)</span> <span class="k">for</span> <span class="n">letter</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">first</span><span class="o">.</span><span class="n">most_common</span><span class="p">()),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">pct</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="mf">4.62</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span> <span class="mf">0.74</span><span class="p">)]</span>
    <span class="k">assert</span> <span class="n">pct</span><span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">:]</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="mf">4.7</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;c&#39;</span><span class="p">,</span> <span class="mf">3.38</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="mf">4.22</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="mf">11.22</span><span class="p">)]</span>


<span class="c1">### Grammar.</span>

<span class="c1"># We don&#39;t parse English into the tagged structure.</span>
<span class="c1"># The material to be translated needs to be marked up manually.</span>
<span class="c1"># (Use NLTK to create tagged structures https://www.nltk.org/api/nltk.parse.stanford.html)</span>


<div class="viewcode-block" id="Tag">
<a class="viewcode-back" href="../language.html#language.Tag">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Tag</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tagged text that forms a tree. (Similar to NLTK.Tree.)&quot;&quot;&quot;</span>
    <span class="n">pos</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># Part of Speech. &quot;S&quot;, &quot;NP&quot;, &quot;VP&quot;, &quot;ADVP&quot;, &quot;MD&quot;, &quot;TV&quot;, &quot;IV&quot;, &quot;DatV&quot;, &quot;SV&quot;, &quot;PP&quot;, &quot;IN&quot;</span>
    <span class="n">words</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="s1">&#39;str | Tag&#39;</span><span class="p">]</span>  <span class="c1"># Terminal or Tag</span>

<div class="viewcode-block" id="Tag.from_text">
<a class="viewcode-back" href="../language.html#language.Tag.from_text">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_text</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tag&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse (tag (tag word) (tag word)) kinds of structures.&quot;&quot;&quot;</span>
        <span class="n">lex_pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\(|\)|\s+|[^\s()]+&quot;</span><span class="p">)</span>
        <span class="n">tokens</span> <span class="o">=</span> <span class="p">(</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">lex_pat</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">source</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">t</span><span class="o">.</span><span class="n">isspace</span><span class="p">())</span>
        <span class="n">symbols</span> <span class="o">=</span> <span class="n">deque</span><span class="p">(</span><span class="n">tokens</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Tag</span><span class="o">.</span><span class="n">from_symbols</span><span class="p">(</span><span class="n">symbols</span><span class="p">)</span></div>


<div class="viewcode-block" id="Tag.from_symbols">
<a class="viewcode-back" href="../language.html#language.Tag.from_symbols">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_symbols</span><span class="p">(</span><span class="n">symbols</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tag&quot;</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">symbols</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Invalid structure </span><span class="si">{</span><span class="n">symbols</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="n">tag</span> <span class="o">=</span> <span class="n">symbols</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
        <span class="n">words</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">symbols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
                <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Tag</span><span class="o">.</span><span class="n">from_symbols</span><span class="p">(</span><span class="n">symbols</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">symbols</span><span class="o">.</span><span class="n">popleft</span><span class="p">())</span>
        <span class="k">assert</span> <span class="n">symbols</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Invalid structure </span><span class="si">{</span><span class="n">symbols</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">Tag</span><span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">words</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Tag(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="si">!r}</span><span class="s2">, [</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">c</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="p">)</span><span class="si">}</span><span class="s2">])&quot;</span>

<div class="viewcode-block" id="Tag.clean">
<a class="viewcode-back" href="../language.html#language.Tag.clean">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">words</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">clean</span><span class="p">())</span>
        <span class="k">return</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></div>
</div>



<span class="k">def</span><span class="w"> </span><span class="nf">test_tag</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">src</span> <span class="o">=</span> <span class="s1">&#39;(S (VP (TV kill) (NP (DET the) (NP mage))))&#39;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">from_text</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">t</span> <span class="o">==</span> <span class="n">Tag</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[</span>
            <span class="n">Tag</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;VP&#39;</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[</span>
                <span class="n">Tag</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;TV&#39;</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;kill&#39;</span><span class="p">]),</span>
                <span class="n">Tag</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;NP&#39;</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[</span>
                    <span class="n">Tag</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;DET&#39;</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;the&#39;</span><span class="p">]),</span>
                    <span class="n">Tag</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;NP&#39;</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mage&#39;</span><span class="p">])</span>
                <span class="p">])</span>
            <span class="p">])</span>
        <span class="p">])</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;(S (VP (TV kill) (NP (DET the) (NP mage))))&quot;</span>
    <span class="k">assert</span> <span class="n">t</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;kill the mage&quot;</span>


<div class="viewcode-block" id="TransformRule">
<a class="viewcode-back" href="../language.html#language.TransformRule">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TransformRule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find a structure like (TAG $x $y) and transform to (TAG $y $x).</span>

<span class="sd">    This has a number of limitations, of course.</span>
<span class="sd">    Principally, it doesn&#39;t use Chomsky Normal Form.</span>
<span class="sd">    In CNF, every production having either two non-terminals or one terminal on the right-hand side.</span>
<span class="sd">    This seems similar to the way lambda calculus rewrites higher-arity operators as single-operand lambdas.</span>

<span class="sd">    ..  todo:: Expand placeholders to include transformations like stemming a word.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_source</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">from_text</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tag_target</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">from_text</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

<div class="viewcode-block" id="TransformRule.match">
<a class="viewcode-back" href="../language.html#language.TransformRule.match">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">match</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag_source</span><span class="p">:</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">some_content</span><span class="p">:</span> <span class="n">Tag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Match the entire tag pattern and the content being examined.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">some_content</span><span class="o">.</span><span class="n">pos</span> <span class="o">==</span> <span class="n">tag_source</span><span class="o">.</span><span class="n">pos</span><span class="p">:</span>
            <span class="c1"># Descend to see if internal structure inside *also* matches</span>
            <span class="n">child_matches</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">src_child</span><span class="p">,</span> <span class="n">content_child</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">zip_longest</span><span class="p">(</span><span class="n">tag_source</span><span class="o">.</span><span class="n">words</span><span class="p">,</span> <span class="n">some_content</span><span class="o">.</span><span class="n">words</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">src_child</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">content_child</span><span class="p">:</span>
                    <span class="c1"># lengths do not match</span>
                    <span class="n">child_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_child</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                    <span class="c1"># Two kinds of strings, placeholders and terminals.</span>
                    <span class="k">if</span> <span class="n">src_child</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">):</span>
                        <span class="c1"># Placeholder, e.g. &quot;$x&quot;, matches anything.</span>
                        <span class="n">child_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># Terminals must match</span>
                        <span class="n">child_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">src_child</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">content_child</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_child</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
                    <span class="c1"># Tag, e.g. (&quot;PP&quot;, [words])</span>
                    <span class="n">child_matches</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">src_child</span><span class="p">,</span> <span class="n">content_child</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">src_child</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">tag_source</span><span class="o">.</span><span class="n">words</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="n">child_matches</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="TransformRule.placeholders">
<a class="viewcode-back" href="../language.html#language.TransformRule.placeholders">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">placeholders</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag_source</span><span class="p">:</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">some_content</span><span class="p">:</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">variables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tag</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Given a pattern and tagged content, locate and assign values to $ placeholders.</span>
<span class="sd">        This does a recursive depth-first search.</span>

<span class="sd">        ..  todo:: Tolerate ``${w|stem}`` which will apply a ``stem()`` function to ``w``.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">src_child</span><span class="p">,</span> <span class="n">content_child</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tag_source</span><span class="o">.</span><span class="n">words</span><span class="p">,</span> <span class="n">some_content</span><span class="o">.</span><span class="n">words</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_child</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">src_child</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">):</span>
                    <span class="n">variables</span><span class="p">[</span><span class="n">src_child</span><span class="p">]</span> <span class="o">=</span> <span class="n">content_child</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># Tag, e.g. (&quot;PP&quot;, [words])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">placeholders</span><span class="p">(</span><span class="n">src_child</span><span class="p">,</span> <span class="n">content_child</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span></div>


<div class="viewcode-block" id="TransformRule.emit">
<a class="viewcode-back" href="../language.html#language.TransformRule.emit">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tag_target</span><span class="p">:</span> <span class="n">Tag</span><span class="p">,</span> <span class="n">variables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tag</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Tag</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Replace ``$`` placeholders with values. Apply functions like ``${x|stem}``&quot;&quot;&quot;</span>
        <span class="n">rewrite</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="n">tag_target</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">tag_target</span><span class="o">.</span><span class="n">words</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">):</span>
                    <span class="n">rewrite</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">Tag</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;?&quot;</span><span class="p">])))</span>
                <span class="k">else</span><span class="p">:</span> <span class="c1"># Literal</span>
                    <span class="n">rewrite</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span> <span class="c1"># Tag</span>
                <span class="n">rewrite</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">variables</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">rewrite</span></div>


<div class="viewcode-block" id="TransformRule.apply">
<a class="viewcode-back" href="../language.html#language.TransformRule.apply">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">some_content</span><span class="p">:</span> <span class="n">Tag</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tag</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Apply this rule to some tagged content.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag_source</span><span class="p">,</span> <span class="n">some_content</span><span class="p">):</span>
            <span class="c1"># Return revised content.</span>
            <span class="n">variables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tag</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">placeholders</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag_source</span><span class="p">,</span> <span class="n">some_content</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tag_target</span><span class="p">,</span> <span class="n">variables</span><span class="p">)</span>

        <span class="c1"># Descend into structure looking for a match.</span>
        <span class="c1"># Return a copy of the original with ONLY matching children changed.</span>
        <span class="n">rewrite</span> <span class="o">=</span> <span class="n">Tag</span><span class="p">(</span><span class="n">some_content</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">some_content</span><span class="o">.</span><span class="n">words</span><span class="p">:</span>
            <span class="c1"># RECURSIVE DESCENT -- depth-first.</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="c1"># Terminal is untouched</span>
                <span class="n">rewrite</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">Tag</span><span class="p">):</span>
                <span class="c1"># Tag might be rewritten</span>
                <span class="n">rewrite</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s2"> in </span><span class="si">{</span><span class="n">some_content</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">rewrite</span></div>
</div>


<span class="k">def</span><span class="w"> </span><span class="nf">test_transform_rule</span><span class="p">():</span>
    <span class="n">rule1</span> <span class="o">=</span> <span class="n">TransformRule</span><span class="p">(</span><span class="s2">&quot;(S (NP $n) (VP $v $n2))&quot;</span><span class="p">,</span> <span class="s2">&quot;(S (VP $v) (NP $n) (PP a $n2))&quot;</span><span class="p">)</span>
    <span class="n">sa</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">from_text</span><span class="p">(</span><span class="s2">&quot;(S (NP I) (VP am (NP groot)))&quot;</span><span class="p">)</span>
    <span class="n">xform_sa1</span> <span class="o">=</span> <span class="n">rule1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">sa</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">xform_sa1</span> <span class="o">==</span> <span class="n">Tag</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[</span>
        <span class="n">Tag</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;VP&#39;</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;am&quot;</span><span class="p">]),</span>
        <span class="n">Tag</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;NP&#39;</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;I&quot;</span><span class="p">]),</span>
        <span class="n">Tag</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;PP&#39;</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;a&quot;</span><span class="p">,</span>
            <span class="n">Tag</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="s1">&#39;NP&#39;</span><span class="p">,</span> <span class="n">words</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;groot&quot;</span><span class="p">])</span>
        <span class="p">])</span>
    <span class="p">])</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">xform_sa1</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;(S (VP am) (NP I) (PP a (NP groot)))&quot;</span>
    <span class="k">assert</span> <span class="n">xform_sa1</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;am I a groot&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">test_rule_pair</span><span class="p">():</span>
    <span class="n">rule1</span> <span class="o">=</span> <span class="n">TransformRule</span><span class="p">(</span><span class="s2">&quot;(S (NP (DET $d) (N $n)) (VP $v $n2))&quot;</span><span class="p">,</span> <span class="s2">&quot;(S (VP $v) (NP $n $d) $n2)&quot;</span><span class="p">)</span>
    <span class="n">rule2</span> <span class="o">=</span> <span class="n">TransformRule</span><span class="p">(</span><span class="s2">&quot;(VP $x (ADVP (NP $y)))&quot;</span><span class="p">,</span> <span class="s2">&quot;(VP $x (PP with (NP $y)))&quot;</span><span class="p">)</span>
    <span class="n">sb</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">from_text</span><span class="p">(</span><span class="s2">&quot;(S (NP (DET the) (N mage)) (VP dies (ADVP (NP slowly))))&quot;</span><span class="p">)</span>
    <span class="n">xform_sb2</span> <span class="o">=</span> <span class="n">rule2</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">sb</span><span class="p">)</span>
    <span class="n">xform_sb1</span> <span class="o">=</span> <span class="n">rule1</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">xform_sb2</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">str</span><span class="p">(</span><span class="n">xform_sb1</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;(S (VP dies) (NP mage the) (PP with (NP slowly)))&quot;</span>
    <span class="k">assert</span> <span class="n">xform_sb1</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;dies mage the with slowly&quot;</span>


<span class="c1"># Main App(s)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">translate</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">maker</span><span class="p">:</span> <span class="n">WordMaker</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Tag</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use the given WordMaker and transformation rules to translate a tagged sentence.</span>

<span class="sd">    ..  todo::</span>

<span class="sd">        -   R1-a. See test_transform_rule</span>
<span class="sd">        -   R1-b. See test_rule_pair, but reformat noun-determiner ``(NP ${n|suffix(d)})``</span>
<span class="sd">        -   R1-c. Special case with no determiner, inject generic &quot;a&quot;.</span>
<span class="sd">        -   R2. Stem the adverb to drop the adverbial suffix &quot;-ly&quot;, ``(VP ${v|stem|tense(m)})``</span>
<span class="sd">        -   R3. Rewrite individual verbs with mode/tense as suffix. ``(VP (MD $m) (VP $v)) -&gt; (VP ${v|stem|tense(m)})`` add tense prefix to verb</span>
<span class="sd">        -   R4. Rewrite individual nouns with determiners ``(NP (DET $d) (N $n)) -&gt; (NP ${n|suffix(d)})``</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Special case of no-determiner.</span>
    <span class="n">rule1c</span> <span class="o">=</span> <span class="n">TransformRule</span><span class="p">(</span><span class="s2">&quot;(S (NP $n) (VP $v $n2))&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;(S (VP $v) (NP $n) (PP a $n2))&quot;</span><span class="p">)</span>
    <span class="n">phrase</span> <span class="o">=</span> <span class="n">Tag</span><span class="o">.</span><span class="n">from_text</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="n">xform_s1</span> <span class="o">=</span> <span class="n">rule1c</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">phrase</span><span class="p">)</span>

    <span class="n">words</span> <span class="o">=</span> <span class="p">(</span><span class="n">maker</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">xform_s1</span><span class="o">.</span><span class="n">clean</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">xform_s1</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">words</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_options</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">-&gt;</span> <span class="n">argparse</span><span class="o">.</span><span class="n">Namespace</span><span class="p">:</span>
    <span class="n">seed_algo</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">hash_seed</span><span class="p">,</span> <span class="s1">&#39;hash&#39;</span><span class="p">:</span> <span class="n">hash_seed</span><span class="p">,</span>
        <span class="s1">&#39;n&#39;</span><span class="p">:</span> <span class="n">naive_seed</span><span class="p">,</span> <span class="s1">&#39;naive&#39;</span><span class="p">:</span> <span class="n">naive_seed</span><span class="p">}</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-a&#39;</span><span class="p">,</span> <span class="s1">&#39;--algorithm&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s1">&#39;hash&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-g&#39;</span><span class="p">,</span> <span class="s1">&#39;--generate&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;spew words&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-w&#39;</span><span class="p">,</span> <span class="s1">&#39;--words&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;translate words&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s1">&#39;-t&#39;</span><span class="p">,</span> <span class="s1">&#39;--translate&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s1">&#39;store&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;translate a tagged phrase&quot;</span><span class="p">)</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">options</span><span class="o">.</span><span class="n">algorithm</span> <span class="o">=</span> <span class="n">seed_algo</span><span class="p">[</span><span class="n">options</span><span class="o">.</span><span class="n">algorithm</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s2">&quot;Alogorithm </span><span class="si">{}</span><span class="s2"> isn&#39;t known&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
        <span class="k">raise</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentTypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">options</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">options</span> <span class="o">=</span> <span class="n">get_options</span><span class="p">()</span>
    <span class="n">maker</span> <span class="o">=</span> <span class="n">WordMaker</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">algorithm</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">generate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">generate</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">maker</span><span class="o">.</span><span class="n">word</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">words</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">options</span><span class="o">.</span><span class="n">words</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">maker</span><span class="o">.</span><span class="n">word</span><span class="p">(</span><span class="n">w</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">translate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">tagged</span><span class="p">,</span> <span class="n">words</span> <span class="o">=</span> <span class="n">translate</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">translate</span><span class="p">,</span> <span class="n">maker</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">options</span><span class="o">.</span><span class="n">translate</span><span class="p">,</span> <span class="n">tagged</span><span class="o">.</span><span class="n">clean</span><span class="p">(),</span> <span class="n">words</span> <span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Fiction Tools</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../plot.html">plot.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../terrain.html">terrain-tk.py and notebooks/terrain</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language.html">language.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../features.html">features.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../names.html">names.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../miseries.html">miseries.py</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, S.Lott.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>